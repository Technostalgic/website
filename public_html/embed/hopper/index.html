<head>
	<script type="application/javascript">"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&"function"==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},_createClass=function(){function c(g,j){for(var n,k=0;k<j.length;k++)n=j[k],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(g,n.key,n)}return function(g,j,k){return j&&c(g.prototype,j),k&&c(g,k),g}}();function _classCallCheck(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function")}var vec2=function(){function c(){var g=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,j=1<arguments.length&&void 0!==arguments[1]?arguments[1]:g;_classCallCheck(this,c),this.x=g,this.y=j}return _createClass(c,[{key:"normalized",value:function(){var j=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.multiply(j/this.distance())}},{key:"multiply",value:function(j){return new c(this.x*j,this.y*j)}},{key:"plus",value:function(j){return new c(this.x+j.x,this.y+j.y)}},{key:"minus",value:function(j){return this.plus(j.inverted)}},{key:"rotate",value:function(j){var k=this.direction,n=this.distance();return k+=j,c.fromAng(k,n)}},{key:"equals",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e-4;return Math.abs(this.x-j.x)<=k&&Math.abs(this.y-j.y)<=k}},{key:"toPhysVector",value:function(){return Matter.Vector.create(this.x,this.y)}},{key:"distance",value:function(){var j=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;null===j&&(j=new c);var k=Math.sqrt(Math.pow(this.x-j.x,2)+Math.pow(this.y-j.y,2));return k}},{key:"clone",value:function(){return new c(this.x,this.y)}},{key:"toString",value:function(){return"vector<"+this.x+", "+this.y+">"}},{key:"inverted",get:function(){return this.multiply(-1)}},{key:"direction",get:function(){return Math.atan2(this.y,this.x)}}],[{key:"fromAng",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;return new c(Math.cos(j)*k,Math.sin(j)*k)}},{key:"fromOther",value:function(j){return new c(j.x,j.y)}}]),c}(),transformation=function(){function c(){var g=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new vec2,j=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,k=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new vec2;_classCallCheck(this,c),this.translate=g,this.rotate=j,this.scale=k,this.origin=n}return _createClass(c,[{key:"transformPoint",value:function(j){var k=j;k=k.minus(this.origin),k=k.plus(this.translate),k=k.multiply(this.scale);var n=k.direction,o=k.distance();return k=vec2.fromAng(n-this.rotate,o),k=k.plus(this.origin),k}}]),c}(),dot=function(){function c(g){var j=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;_classCallCheck(this,c),this.pos=g,this.size=j}return _createClass(c,[{key:"distort",value:function(j){this.pos=j.distortPoint(this.pos),this.size*=j.distortTransAtPoint(this.pos).scale}},{key:"transform",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=new transformation(j,k,n);this.pos=o.transformPoint(this.pos),this.size*=n}},{key:"drawFill",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#fff";j.fillStyle=k,j.fillRect(this.pos.x-this.size/2,this.pos.y-this.size/2,this.size,this.size)}}]),c}(),line=function(){function c(g,j){_classCallCheck(this,c),this.start=g,this.end=j}return _createClass(c,[{key:"distort",value:function(j){this.start=j.distortPoint(this.start),this.end=j.distortPoint(this.end)}},{key:"transform",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=new transformation(j,k,n);this.start=o.transformPoint(this.start),this.end=o.transformPoint(this.end)}},{key:"drawOutline",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#ff0",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;j.strokeStyle=k,j.lineWidth=n,j.beginPath(),j.moveTo(this.start.x,this.start.y),j.lineTo(this.end.x,this.end.y),j.stroke()}}]),c}(),polygon=function(){function c(){_classCallCheck(this,c),this._points=[],this._position=new vec2,this._scale=1,this._rotation=0,this._absVerts=[],this._boundingbox=null,this._flipped=!1}return _createClass(c,[{key:"updateBoundingBox",value:function(){var j=this.absVerts;if(1>j.length)return new box(this._position.x,this._position.y);for(var k=j[0].x,n=j[0].x,o=j[0].y,q=j[0].y,s=1;s<j.length;s+=1)k=Math.min(k,j[s].x),n=Math.max(n,j[s].x),o=Math.min(o,j[s].y),q=Math.max(q,j[s].y);this._boundingbox=new box(k,o,n-k,q-o)}},{key:"updateAbsVerts",value:function(){this._absVerts=[];for(var j=0;j<this._points.length;j+=1){var k=this._points[j],n=k.direction,o=k.distance();k=vec2.fromAng(n+this._rotation,o),k=k.multiply(this._scale),k=k.plus(this._position),this._absVerts.push(k)}this.updateBoundingBox()}},{key:"setVerts",value:function(j){this._points=j,this.updateAbsVerts()}},{key:"distort",value:function(j){var k=[];this.absVerts.forEach(function(n){var o=j.distortPoint(n);k.push(o)}),this._absVerts=k}},{key:"move",value:function(j){return this._position=this._position.plus(j),this._absVerts=null,this}},{key:"setPos",value:function(j){return this._position=j,this._absVerts=null,this}},{key:"setScale",value:function(j){return this._scale=j,this._absVerts=null,this}},{key:"setRotation",value:function(j){return this._rotation=j,this._absVerts=null,this}},{key:"setFlipped",value:function(){var j=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;this._flipped=j,this._absVerts=null}},{key:"transform",value:function(j){for(var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=0;o<this._points.length;o+=1){var q=new transformation(j,k,n),s=q.transformPoint(this._points[o]);this._points[o]=s}this._absVerts=null}},{key:"worldPointToLocal",value:function(j){var k=j;k=k.minus(this.pos),k=k.multiply(1/this.scale);var n=k.direction,o=k.distance();return k=vec2.fromAng(n-this.rotation,o),k}},{key:"drawOutline",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#888",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=this.absVerts;if(!(2>o.length)){j.strokeStyle=k,j.lineWidth=n,j.beginPath(),j.moveTo(o[0].x,o[0].y);for(var s,q=0;q<o.length;q+=1)s=q+1,s>=o.length&&(s=0),j.lineTo(o[s].x,o[s].y);j.closePath(),j.stroke()}}},{key:"drawFill",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#888",n=this.absVerts;if(!(3>n.length)){j.fillStyle=k,j.beginPath(),j.moveTo(n[0].x,n[0].y);for(var q,o=0;o<n.length;o+=1)q=o+1,q>=n.length&&(q=0),j.lineTo(n[q].x,n[q].y);j.fill()}}},{key:"boundingBox",get:function(){return null==this._boundingBox&&this.updateBoundingBox(),this._boundingbox}},{key:"absoluteVertices",get:function(){return null==this._absVerts&&this.updateAbsVerts(),this._absVerts}},{key:"absVerts",get:function(){return this.absoluteVertices}},{key:"verts",get:function(){return this._points}},{key:"pos",get:function(){return this._position}},{key:"scale",get:function(){return this._scale}},{key:"rotation",get:function(){return this._rotation}},{key:"flipped",get:function(){return this._flipped}}],[{key:"Rectangle",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:j,n=new c,o=[new vec2(j/-2,k/-2),new vec2(j/-2,k/2),new vec2(j/2,k/2),new vec2(j/2,k/-2)];return n.setVerts(o),n}},{key:"Circle",value:function(j){for(var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:12,n=new c,o=[],q=0;q<k;q+=1){var s=q/k*(2*Math.PI),u=vec2.fromAng(s,j);o.push(u)}return n.setVerts(o),n}}]),c}(),box=function(){function c(){var g=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,j=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,k=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;_classCallCheck(this,c),this.position=new vec2(g,j),this.size=new vec2(k,n)}return _createClass(c,[{key:"drawOutline",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#888",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;j.strokeStyle=k,j.lineWidth=n,j.strokeRect(this.position.x,this.position.y,this.size.x,this.size.y)}},{key:"drawFill",value:function(j){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"#888";j.fillStyle=k,j.fillRect(this.position.x,this.position.y,this.size.x,this.size.y)}},{key:"containsPoint",value:function(j){return j.x>=this.position.x&&j.x<=this.right()&&j.y>=this.position.y&&j.y<=this.bottom()}},{key:"overlaps",value:function(j){return!(j.left>this.right||j.right<this.left||j.top>this.bottom||j.bottom<this.top)}},{key:"top",get:function(){return this.position.y}},{key:"bottom",get:function(){return this.position.y+this.size.y}},{key:"left",get:function(){return this.position.x}},{key:"right",get:function(){return this.position.x+this.size.x}}]),c}();function wrapValue(c){var g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:256;return 0>c?g+c%g:c>=g?c%g:c}var _get=function c(g,j,k){null===g&&(g=Function.prototype);var n=Object.getOwnPropertyDescriptor(g,j);if(n===void 0){var o=Object.getPrototypeOf(g);return null===o?void 0:c(o,j,k)}if("value"in n)return n.value;var q=n.get;return void 0===q?void 0:q.call(k)},_createClass=function(){function c(g,j){for(var n,k=0;k<j.length;k++)n=j[k],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(g,n.key,n)}return function(g,j,k){return j&&c(g.prototype,j),k&&c(g,k),g}}();function _possibleConstructorReturn(c,g){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&("object"===("undefined"==typeof g?"undefined":_typeof(g))||"function"==typeof g)?g:c}function _inherits(c,g){if("function"!=typeof g&&null!==g)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof g?"undefined":_typeof(g)));c.prototype=Object.create(g&&g.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(c,g):c.__proto__=g)}function _classCallCheck(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function")}var character=function(){function c(){_classCallCheck(this,c),this.pos=new vec2,this.vel=new vec2,this.size=10,this.health=1}return _createClass(c,[{key:"applyGravity",value:function(){var j=new vec2,k=this;planets.forEach(function(n){var o=n.pos.minus(k.pos).direction,q=n.mass/Math.pow(n.pos.distance(k.pos),2),s=vec2.fromAng(o,q/2);j=j.plus(s)}),this.vel=this.vel.plus(j)}},{key:"checkCollisions",value:function(){var j=this;planets.forEach(function(k){j.isCollidingWithPlanet(k)&&j.planetCollide(k)})}},{key:"planetCollide",value:function(j){var k=this.pos.minus(j.pos).direction,n=this.size+j.size;this.pos=j.pos.plus(vec2.fromAng(k,n))}},{key:"isCollidingWithPlanet",value:function(j){return this.pos.distance(j.pos)<=this.size+j.size}},{key:"update",value:function(){this.pos=this.pos.plus(this.vel),this.checkCollisions()}},{key:"draw",value:function(j){j.strokeStyle="#000",j.fillStyle="#ddd",j.lineWidth=1,j.beginPath(),j.arc(this.pos.x,this.pos.y,this.size,0,2*Math.PI),j.fill(),j.stroke()}}]),c}(),projectile=function(c){function g(j){_classCallCheck(this,g);var k=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return k.team=0,k.pos=j,k.size=3,k.openTracer(),k}return _inherits(g,c),_createClass(g,[{key:"planetCollide",value:function(k){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"planetCollide",this).call(this,k),this.remove()}},{key:"remove",value:function(){this.currentTracer&&this.currentTracer.close(),projectiles.includes(this)&&projectiles.splice(projectiles.indexOf(this),1)}},{key:"openTracer",value:function(){this.currentTracer=new tracer,this.currentTracer.color=[245,235,50],this.currentTracer.add()}},{key:"update",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"update",this).call(this),this.currentTracer&&this.currentTracer.trace(this.pos.clone())}},{key:"draw",value:function(k){k.strokeStyle="#a90",k.fillStyle="#ffa",k.lineWidth=1,k.beginPath(),k.arc(this.pos.x,this.pos.y,this.size,0,2*Math.PI),k.fill(),k.stroke()}}],[{key:"fire",value:function(k,n,o){var q=new Projectile(k);q.vel=vec2.fromAng(n,o),projectiles.push(q)}}]),g}(character),playerProjectile=function(c){function g(j){_classCallCheck(this,g);var k=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,j));return k.team=0,k.size=3,k.flightTime=0,k}return _inherits(g,c),_createClass(g,[{key:"planetCollide",value:function(k){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"planetCollide",this).call(this,k),this.explode()}},{key:"explode",value:function(){var k=25,n=new effect(this.pos);n.size=k,n.add(),this.remove(),playSound(sfx.explosion);for(var o=enemies.length-1;0<=o;o--)0<enemies.tilSpawn||enemies[o].pos.distance(this.pos)<=k+enemies[o].size&&(enemies[o].points*=this.scoreMultiplier,enemies[o].die())}},{key:"update",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"update",this).call(this),this.applyGravity(),this.flightTime+=1}},{key:"scoreMultiplier",get:function(){return Math.min(4,Math.floor(this.flightTime/30)+1)}}],[{key:"fire",value:function(k,n,o){var q=new g(k);q.vel=vec2.fromAng(n,o),projectiles.push(q)}}]),g}(projectile),enemyProjectile=function(c){function g(j){_classCallCheck(this,g);var k=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,j));return k.team=1,k.size=5,k}return _inherits(g,c),_createClass(g,[{key:"openTracer",value:function(){this.currentTracer=new tracer,this.currentTracer.color=[255,150,150],this.currentTracer.life=60,this.currentTracer.add()}},{key:"remove",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"remove",this).call(this),playSound(sfx.explosionSmall)}},{key:"update",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"update",this).call(this),(this.x<=-this.size||this.x>=600+this.size||this.y<=-this.size||this.y>=600+this.size)&&this.remove()}},{key:"draw",value:function(k){k.strokeStyle="#a11",k.fillStyle="#faa",k.lineWidth=1,k.beginPath(),k.arc(this.pos.x,this.pos.y,this.size,0,2*Math.PI),k.fill(),k.stroke()}}],[{key:"fire",value:function(k,n,o){var q=new g(k);q.vel=vec2.fromAng(n,o),projectiles.push(q)}}]),g}(projectile),item=function(c){function g(){_classCallCheck(this,g);var j=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return j.size=4,j.staticPos=!1,j.openTracer(),j}return _inherits(g,c),_createClass(g,[{key:"planetCollide",value:function(k){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"planetCollide",this).call(this,k),this.staticPos=!0,this.checkCollisions=function(){},this.currentTracer.trace(this.pos),this.currentTracer.close()}},{key:"add",value:function(){items.push(this)}},{key:"remove",value:function(){this.currentTracer&&this.currentTracer.close(),items.includes(this)&&items.splice(items.indexOf(this),1)}},{key:"pickUp",value:function(){this.flash(),this.remove(),playSound(sfx.pickup)}},{key:"flash",value:function(){var k=new effect(this.pos);k.size=this.size,k.color=[160,160,255],k.add()}},{key:"openTracer",value:function(){this.currentTracer=new tracer,this.currentTracer.color=[160,160,255],this.currentTracer.life=100,this.currentTracer.add()}},{key:"update",value:function(){this.staticPos||(this.currentTracer.trace(this.pos),_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"update",this).call(this),this.applyGravity())}},{key:"draw",value:function(k){k.strokeStyle="#55f",k.fillStyle="#aaf",k.lineWidth=1,k.beginPath(),k.arc(this.pos.x,this.pos.y,this.size,0,2*Math.PI),k.fill(),k.stroke()}}]),g}(character),item_ammo=function(c){function g(){return _classCallCheck(this,g),_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this))}return _inherits(g,c),_createClass(g,[{key:"pickUp",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"pickUp",this).call(this),player1.ammo+=1}},{key:"add",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"add",this).call(this),ammoitems+=1}},{key:"remove",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"remove",this).call(this),ammoitems-=1}}]),g}(item);function updateCharacters(c){for(var g=c.length-1;0<=g;g--)c[g]&&c[g].update()}function drawCharacters(c,g){c.forEach(function(j){j.draw(g)})}var _createClass=function(){function c(g,j){for(var n,k=0;k<j.length;k++)n=j[k],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(g,n.key,n)}return function(g,j,k){return j&&c(g.prototype,j),k&&c(g,k),g}}(),_get=function c(g,j,k){null===g&&(g=Function.prototype);var n=Object.getOwnPropertyDescriptor(g,j);if(n===void 0){var o=Object.getPrototypeOf(g);return null===o?void 0:c(o,j,k)}if("value"in n)return n.value;var q=n.get;return void 0===q?void 0:q.call(k)};function _classCallCheck(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(c,g){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&("object"===("undefined"==typeof g?"undefined":_typeof(g))||"function"==typeof g)?g:c}function _inherits(c,g){if("function"!=typeof g&&null!==g)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof g?"undefined":_typeof(g)));c.prototype=Object.create(g&&g.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(c,g):c.__proto__=g)}var enemy=function(c){function g(){_classCallCheck(this,g);var j=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return j.ss=!0,j.size=15,j.tilSpawn=120,j.chooseRandomPosition(),j.points=50,j}return _inherits(g,c),_createClass(g,[{key:"chooseRandomPosition",value:function(){this.pos=new vec2(rand(50,550),rand(100,550))}},{key:"add",value:function(){enemies.push(this)}},{key:"remove",value:function(){enemies.includes(this)&&enemies.splice(enemies.indexOf(this),1),updateTilSpawn()}},{key:"die",value:function(){!enemies.includes(this)||0<this.tilSpawn||(this.explode(),this.remove(),addScore(this.points,this.pos))}},{key:"explode",value:function(){var k=new effect(this.pos);k.size=2*this.size,k.color=[255,150,150],k.add(),gib.createGibs(this.pos,8,10),playSound(sfx.enemyDeath)}},{key:"canSeePlayer",value:function(){for(var u,k=this.pos.clone(),n=player1.pos.clone(),o=n.distance(k),q=n.minus(k).direction,s=planets.length-1;0<=s;s--)if(u=planets[s],!(k.distance(u.pos)>o)){var z=k.distance(u.pos);if(vec2.fromAng(q,z).plus(k).distance(u.pos)<=u.size)return!1}return!0}},{key:"overlapsPlanet",value:function(){var k=!1,n=this;return planets.forEach(function(o){n.pos.distance(o.pos)<=n.size+o.size&&(k=!0)}),k}},{key:"behave",value:function(){}},{key:"checkCollisions",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"checkCollisions",this).call(this);for(var k=this,n=projectiles.length-1;0<=n;n--)1!=projectiles[n].team&&projectiles[n].pos.distance(this.pos)<=projectiles[n].size+this.size&&this.projectileCollide(projectiles[n]);player1.pos.distance(this.pos)<=player1.size+this.size&&this.playerCollide(player1)}},{key:"projectileCollide",value:function(k){this.points*=k.scoreMultiplier,this.die(),k.explode()}},{key:"playerCollide",value:function(k){k.die()}},{key:"drawSpawnPoint",value:function(k){var n=3*this.size,o=1-this.tilSpawn/120;o=Math.pow(o,5),k.fillStyle="rgba(255, 120, 120, "+(o+0.05)+")",k.beginPath(),k.arc(this.pos.x,this.pos.y,n-o*n+this.size,0,2*Math.PI),k.fill()}},{key:"update",value:function(){return 0<this.tilSpawn?(this.tilSpawn-=1,void(this.ss&&10>this.tilSpawn&&(playSound(sfx.enemySpawn),this.ss=!1))):void(_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"update",this).call(this),this.behave())}},{key:"draw",value:function(k){return 0<this.tilSpawn?void this.drawSpawnPoint(k):void(k.strokeStyle="#a11",k.fillStyle="#faa",k.lineWidth=1,k.beginPath(),k.arc(this.pos.x,this.pos.y,this.size,0,2*Math.PI),k.fill(),k.stroke())}}]),g}(character),en_mover=function(c){function g(){_classCallCheck(this,g);var j=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return j.size=10,j.points=100,j}return _inherits(g,c),_createClass(g,[{key:"chooseRandomPosition",value:function(){this.speed=rand(0.5,rand(0.5,1));do this.pos=new vec2(rand(50,550),rand(100,550));while(this.overlapsPlanet());this.vel=vec2.fromAng(rand(0,2*Math.PI),this.speed)}},{key:"planetCollide",value:function(k){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"planetCollide",this).call(this,k),this.vel=vec2.fromAng(rand(0,2*Math.PI),this.speed)}},{key:"behave",value:function(){player1.isDead||((this.pos.x<=this.size||this.pos.x>=600-this.size||this.pos.y<=this.size||this.pos.y>=600-this.size)&&(this.vel=vec2.fromAng(rand(0,2*Math.PI),this.speed),this.pos=new vec2(Math.min(Math.max(this.pos.x,this.size),600-this.size),Math.min(Math.max(this.pos.y,this.size),600-this.size))),this.canSeePlayer()&&(this.vel=vec2.fromAng(player1.pos.minus(this.pos).direction,this.speed)))}},{key:"draw",value:function(k){if(0<this.tilSpawn)return void this.drawSpawnPoint(k);var n=Math.abs(350-timeElapsed%700)/350,o=this.vel.direction,q=vec2.fromAng(o+1.5*Math.PI/3,this.size*n+0.5),s=vec2.fromAng(o-1.5*Math.PI/3,this.size*n+0.5),u=[vec2.fromAng(o-Math.PI/5,this.size).plus(this.pos),vec2.fromAng(o,this.size).plus(this.pos),vec2.fromAng(o+Math.PI/5,this.size).plus(this.pos),q.plus(this.pos),vec2.fromAng(o+4*Math.PI/5,1.5*this.size).plus(this.pos),vec2.fromAng(o-4*Math.PI/5,1.5*this.size).plus(this.pos),s.plus(this.pos)];k.strokeStyle="#a11",k.fillStyle="#faa",k.lineWidth=1,k.beginPath(),k.moveTo(u[0].x,u[0].y),u.forEach(function(z){k.lineTo(z.x,z.y)}),k.closePath(),k.fill(),k.stroke()}}]),g}(enemy),en_shooter=function(c){function g(){_classCallCheck(this,g);var j=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return j.fireWait=0,j.rotation=rand(0,2*Math.PI),j.tilfire=60,j.points=150,j}return _inherits(g,c),_createClass(g,[{key:"chooseRandomPosition",value:function(){do this.pos=new vec2(rand(50,550),rand(100,550));while(this.overlapsPlanet())}},{key:"behave",value:function(){return this.tilfire-=1,player1.isDead?void(this.tilfire=30):void(this.canSeePlayer()?(this.rotateToPlayer(),0>=this.tilfire&&this.shoot()):this.tilfire=Math.max(30,this.tilfire))}},{key:"rotateToPlayer",value:function(){var k=player1.pos.minus(this.pos).direction,n=Math.PI/90,o=angDist(this.rotation,k);return Math.abs(o)<n?void(this.rotation=k):void(o=Math.sign(o),this.rotation+=o*n)}},{key:"shoot",value:function(){this.tilfire=60;var k=this.rotation;k+=rand(-.1,.1),enemyProjectile.fire(this.pos,k,7.5),playSound(sfx.shooterShoot)}},{key:"explode",value:function(){var k=new effect(this.pos);k.size=2*this.size,k.color=[255,150,150],k.add(),gib.createGibs(this.pos,10,10),playSound(sfx.shooterDeath)}},{key:"draw",value:function(k){if(0<this.tilSpawn)return void this.drawSpawnPoint(k);var n=this.rotation,o=[vec2.fromAng(n-2*Math.PI/5,this.size).plus(this.pos),vec2.fromAng(n-1*Math.PI/5,this.size/2).plus(this.pos),vec2.fromAng(n,this.size*(0.5+this.tilfire/60)).plus(this.pos),vec2.fromAng(n+1*Math.PI/5,this.size/2).plus(this.pos),vec2.fromAng(n+2*Math.PI/5,this.size).plus(this.pos),vec2.fromAng(n+4*Math.PI/5,this.size).plus(this.pos),vec2.fromAng(n-4*Math.PI/5,this.size).plus(this.pos)];k.strokeStyle="#a11",k.fillStyle="#faa",k.lineWidth=1,k.beginPath(),k.moveTo(o[0].x,o[0].y),o.forEach(function(q){k.lineTo(q.x,q.y)}),k.closePath(),k.fill(),k.stroke()}}]),g}(enemy),en_orbiter=function(c){function g(){_classCallCheck(this,g);var j=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return j.size=10,j.speed=rand(1,rand(1,3))*(2*Math.floor(rand(0,2))-1),j.rotation=rand(0,2*Math.PI),j}return _inherits(g,c),_createClass(g,[{key:"chooseRandomPosition",value:function(){this.orbitDist=rand(20,35);var k=planets[Math.floor(rand(0,planets.length))];this.focusPlanet=k;var n=rand(0,2*Math.PI);this.pos=this.focusPlanet.pos.plus(vec2.fromAng(n,this.orbitDist+this.focusPlanet.size))}},{key:"behave",value:function(){var k=this.pos.minus(this.focusPlanet.pos).direction,n=vec2.fromAng(k+Math.PI/2,this.speed);this.vel=n,this.pos=this.focusPlanet.pos.plus(vec2.fromAng(k,this.orbitDist+this.focusPlanet.size)),this.rotation+=this.speed/25}},{key:"draw",value:function(k){if(0<this.tilSpawn)return void this.drawSpawnPoint(k);var n=[vec2.fromAng(this.rotation,1.4*this.size).plus(this.pos),vec2.fromAng(Math.PI/2+this.rotation,1.4*this.size).plus(this.pos),vec2.fromAng(Math.PI+this.rotation,1.4*this.size).plus(this.pos),vec2.fromAng(Math.PI/-2+this.rotation,1.4*this.size).plus(this.pos)];k.strokeStyle="#a11",k.fillStyle="#faa",k.lineWidth=1,k.beginPath(),k.moveTo(n[0].x,n[0].y),n.forEach(function(o){k.lineTo(o.x,o.y)}),k.closePath(),k.fill(),k.stroke()}}]),g}(enemy),en_crawler=function(c){function g(){_classCallCheck(this,g);var j=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return j.speed=rand(0.5,rand(0.5,1.5))*(2*Math.floor(rand(0,2))-1),j}return _inherits(g,c),_createClass(g,[{key:"chooseRandomPosition",value:function(){this.size=10;var k=planets[Math.floor(rand(0,planets.length))];this.focusPlanet=k;var n=rand(0,2*Math.PI);this.pos=this.focusPlanet.pos.plus(vec2.fromAng(n,this.focusPlanet.size+this.size))}},{key:"explode",value:function(){var k=new effect(this.pos);k.size=2*this.size,k.color=[255,150,150],k.add(),gib.createGibs(this.pos,6,7,this.pos.minus(this.focusPlanet.pos).direction),playSound(sfx.enemyDeath)}},{key:"behave",value:function(){var k=this.pos.minus(this.focusPlanet.pos).direction,n=vec2.fromAng(k+Math.PI/2,this.speed);this.vel=n,this.pos=this.focusPlanet.pos.plus(vec2.fromAng(k,this.size+this.focusPlanet.size))}},{key:"draw",value:function(k){if(0<this.tilSpawn)return void this.drawSpawnPoint(k);var n=this.pos.minus(this.focusPlanet.pos).direction,o=Math.abs(timeElapsed%500-250)/250,q=vec2.fromAng(n,-this.size),s=vec2.fromAng(n-Math.PI/4,this.size+10*o),u=vec2.fromAng(n+Math.PI/4,this.size+10*(1-o)),z=[vec2.fromAng(n-Math.PI/2,this.size/2).plus(this.pos).plus(q),s.plus(this.pos).plus(q),vec2.fromAng(n,this.size/2).plus(this.pos).plus(q),u.plus(this.pos).plus(q),vec2.fromAng(n+Math.PI/2,this.size/2).plus(this.pos).plus(q)];k.strokeStyle="#a11",k.fillStyle="#faa",k.lineWidth=1,k.beginPath(),k.moveTo(z[0].x,z[0].y),z.forEach(function(A){k.lineTo(A.x,A.y)}),k.closePath(),k.fill(),k.stroke()}}]),g}(enemy),gib=function(c){function g(j){_classCallCheck(this,g);var k=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return k.pos=j,k.size=5,k}return _inherits(g,c),_createClass(g,[{key:"add",value:function(){gibs.push(this)}},{key:"remove",value:function(){gibs.includes(this)&&gibs.splice(gibs.indexOf(this),1)}},{key:"openTracer",value:function(){this.color=[Math.floor(rand(rand(220,255),255)),200,200],this.currentTracer=new tracer,this.currentTracer.color=this.color,this.currentTracer.life=100,this.currentTracer.add()}},{key:"playerTracer",value:function(){this.color=[200,250,200],this.currentTracer=new tracer,this.currentTracer.color=this.color,this.currentTracer.life=100,this.currentTracer.add()}},{key:"checkCollisions",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"checkCollisions",this).call(this),this.checkEnemyCollisions()}},{key:"checkEnemyCollisions",value:function(){for(var k=enemies.length-1;0<=k;k--)this.pos.distance(enemies[k].pos)<=enemies[k].size+this.size&&this.enemyCollide(enemies[k])}},{key:"enemyCollide",value:function(k){k.points*=2,k.die(),this.explode()}},{key:"planetCollide",value:function(k){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"planetCollide",this).call(this,k),this.explode()}},{key:"explode",value:function(){this.remove();var k=new effect(this.pos);k.size=5,k.color=this.color,k.add(),playSound(sfx.explosionSmall)}},{key:"draw",value:function(){}}],[{key:"createGibs",value:function(k,n,o){for(var A,q=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,s=rand(0,2*Math.PI),u=2*(1/n*Math.PI),z=n;0<z;z--)A=new g(k),q&&(s=q+rand(-Math.PI/2,Math.PI/2)),A.vel=vec2.fromAng(s+rand(-u,u),rand(o/2,o)),A.add(),s+=u}},{key:"createPlayerGibs",value:function(k){for(var z,n=10,o=10,q=rand(0,2*Math.PI),s=2*(1/n*Math.PI),u=n;0<u;u--)z=new g(k),z.playerTracer(),z.pickUp=function(){},z.vel=vec2.fromAng(q+rand(-s,s),rand(o/2,o)),z.add(),q+=s}}]),g}(item);var _createClass=function(){function c(g,j){for(var n,k=0;k<j.length;k++)n=j[k],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(g,n.key,n)}return function(g,j,k){return j&&c(g.prototype,j),k&&c(g,k),g}}(),_get=function c(g,j,k){null===g&&(g=Function.prototype);var n=Object.getOwnPropertyDescriptor(g,j);if(n===void 0){var o=Object.getPrototypeOf(g);return null===o?void 0:c(o,j,k)}if("value"in n)return n.value;var q=n.get;return void 0===q?void 0:q.call(k)};function _classCallCheck(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(c,g){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&("object"===("undefined"==typeof g?"undefined":_typeof(g))||"function"==typeof g)?g:c}function _inherits(c,g){if("function"!=typeof g&&null!==g)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof g?"undefined":_typeof(g)));c.prototype=Object.create(g&&g.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(c,g):c.__proto__=g)}var player=function(c){function g(){_classCallCheck(this,g);var j=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return j.isAlias=!1,j.size=6,j.rotation=0,j.inAir=!0,j.focusPlanet=null,j.acc=0,j.jumpPow=0,j.firePow=0,j.fireAdj=!1,j.currentTracer=null,j.ammo=3,j}return _inherits(g,c),_createClass(g,[{key:"chooseRandPos",value:function(){this.pos=planets[Math.floor(rand(0,planets.length))].pos,this.pos=this.pos.plus(vec2.fromAng(rand(0,2*Math.PI)))}},{key:"control",value:function(k){this.isDead||(this.inAir?this.acc=0:(k.moveLeft&&k.moveRight?this.acc=0:k.moveLeft?this.control_moveLeft():k.moveRight?this.control_moveRight():this.acc=0,k.jump?this.control_jump():0<this.jumpPow&&this.finishJump()),k.fire?this.control_fire():0<this.firePow&&this.finishFire(),0<this.firePow&&(controlState.increasePow&&this.control_increasePow(),controlState.decreasePow&&this.control_decreasePow()))}},{key:"control_moveLeft",value:function(){var k=3;this.acc+=0.1,this.acc>k&&(this.acc=k);var n=vec2.fromAng(this.rotation-Math.PI/2,this.acc);n=n.plus(this.pos.minus(this.focusPlanet.pos).normalized(-1)),this.vel.distance()<n.distance()&&(this.vel=n)}},{key:"control_moveRight",value:function(){var k=3;this.acc+=0.1,this.acc>k&&(this.acc=k);var n=vec2.fromAng(this.rotation+Math.PI/2,this.acc);n=n.plus(this.pos.minus(this.focusPlanet.pos).normalized(-1)),this.vel.distance()<n.distance()&&(this.vel=n)}},{key:"control_jump",value:function(){var k=15;this.jumpPow=(1.95*this.jumpPow+0.05*k)/2,this.jumpPow>k&&(this.jumpPow=k)}},{key:"finishJump",value:function(){if(3>this.jumpPow)return void(this.jumpPow=0);var k=vec2.fromAng(this.rotation,this.jumpPow);this.vel=this.vel.plus(k),this.jumpPow=0,this.openTracer(),this.isAlias||playSound(sfx.jump)}},{key:"control_fire",value:function(){if(0>=this.ammo)return void playSound(sfx.empty,!1);if(!this.fireAdj){this.firePow=(1.97*this.firePow+0.03*18)/2}}},{key:"finishFire",value:function(){return 2>this.firePow?(this.firePow=0,void(this.fireAdj=!1)):void(playerProjectile.fire(this.pos,this.rotation,this.firePow),this.firePow=0,this.fireAdj=!1,this.ammo-=1,!this.isAlias&&playSound(sfx.shoot))}},{key:"control_increasePow",value:function(){this.fireAdj=!0;this.firePow=(1.97*this.firePow+0.03*18)/2}},{key:"control_decreasePow",value:function(){this.fireAdj=!0;var n=(1.97*this.firePow+0.03*18)/2;this.firePow-=Math.max(n-this.firePow,0.1),0>=this.firePow&&(this.firePow=1e-5)}},{key:"checkCollisions",value:function(){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"checkCollisions",this).call(this),this.checkProjectileCollisions(),this.checkItemCollisions()}},{key:"checkProjectileCollisions",value:function(){for(var k=projectiles.length-1;0<=k;k--)0!=projectiles[k].team&&this.pos.distance(projectiles[k].pos)<=this.size+projectiles[k].size&&(projectiles[k].remove(),this.die())}},{key:"checkItemCollisions",value:function(){for(var k=items.length-1;0<=k;k--)items[k].pos.distance(this.pos)<=this.size+items[k].size&&items[k].pickUp()}},{key:"planetCollide",value:function(k){_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"planetCollide",this).call(this,k),this.rotation=this.pos.minus(k.pos).direction,this.focusPlanet=k,this.vel=this.vel.multiply(0.8),this.inAir=!1,this.closeTracer()}},{key:"die",value:function(){this.isDead||(playSound(sfx.death),gib.createPlayerGibs(this.pos),setTimeout(endGame,2500)),this.health=0}},{key:"disableTracers",value:function(){this.tracePath=function(){},this.openTracer=function(){}}},{key:"tracePath",value:function(){null==this.currentTracer&&(this.currentTracer=new tracer,this.currentTracer.add()),this.currentTracer.trace(this.pos.clone())}},{key:"openTracer",value:function(){null==this.currentTracer&&(this.currentTracer=new tracer,this.currentTracer.add()),this.currentTracer.trace(this.pos.clone())}},{key:"closeTracer",value:function(){null==this.currentTracer||(this.currentTracer.trace(this.pos.clone()),this.currentTracer.close(),this.currentTracer=null)}},{key:"drawJumpAim",value:function(k){var n=[],o=this.jumpAlias;n.push(o.pos.clone());for(var q=6;0<q;q--)o.update(),n.push(o.pos.clone());for(var q=1;q<n.length;q++){var s=q-1,u=1-(q+1)/6;k.lineWidth=12*Math.pow(u,2)+2,k.strokeStyle="rgba(200, 200, 250, "+u.toString()+")",k.beginPath(),k.moveTo(n[s].x,n[s].y),k.lineTo(n[q].x,n[q].y),k.stroke()}}},{key:"drawFireAim",value:function(k){var n=[],o=this.fireAlias;o.currentTracer=null,n.push(o.pos.clone());for(var q=this.firePow;0<q&&(o.update(),o.vel.x!=NaN);q--)n.push(o.pos.clone());for(var q=1;q<n.length;q++){var s=q-1,u=1-(q+1)/n.length;k.lineWidth=Math.pow(u,2)+2,k.strokeStyle="rgba(210, 200, 50, "+u.toString()+")",k.beginPath(),k.moveTo(n[s].x,n[s].y),k.lineTo(n[q].x,n[q].y),k.stroke()}}},{key:"update",value:function(){this.isDead||(this.lia=this.inAir,this.inAir=!0,_get(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"update",this).call(this),this.inAir&&(this.applyGravity(),this.tracePath()),this.vel=this.vel.multiply(0.99))}},{key:"draw",value:function(k){if(!this.isDead){k.fillStyle="#ded",k.strokeStyle="#070",k.lineWidth=1;var n=this.pos.plus(vec2.fromAng(this.rotation-Math.PI/4,1.4*this.size)),o=this.pos.plus(vec2.fromAng(this.rotation+Math.PI/4,1.4*this.size));k.beginPath(),k.closePath(),k.arc(this.pos.x,this.pos.y,this.size,this.rotation+Math.PI/2,this.rotation-Math.PI/2),k.lineTo(n.x,n.y),k.lineTo(o.x,o.y),k.closePath(),k.fill(),k.stroke(),3<this.jumpPow&&!this.inAir&&this.drawJumpAim(k),2<this.firePow&&this.drawFireAim(k)}}},{key:"isDead",get:function(){return 0>=this.health}},{key:"jumpAlias",get:function(){var k=new g;return k.isAlias=!0,k.disableTracers(),k.checkItemCollisions=function(){},k.checkProjectileCollisions=function(){},k.rotation=this.rotation,k.pos=this.pos.clone(),k.vel=this.vel.clone(),k.jumpPow=this.jumpPow,k.finishJump(),k}},{key:"fireAlias",get:function(){var k=new playerProjectile(this.pos);return k.vel=vec2.fromAng(this.rotation,this.firePow),k.explode=function(){this.vel=new vec2(NaN)},k}}]),g}(character);var _createClass=function(){function c(g,j){for(var n,k=0;k<j.length;k++)n=j[k],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(g,n.key,n)}return function(g,j,k){return j&&c(g.prototype,j),k&&c(g,k),g}}();function _classCallCheck(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function")}var planet=function(){function c(g){var j=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100;_classCallCheck(this,c),this.pos=g,this.size=j}return _createClass(c,[{key:"draw",value:function(j){j.strokeStyle="#000",j.fillStyle="#ddd",j.lineWidth=1,j.beginPath(),j.arc(this.pos.x,this.pos.y,this.size,0,2*Math.PI),j.closePath(),j.fill(),j.stroke()}},{key:"mass",get:function(){return Math.pow(this.size,2)*Math.PI}}],[{key:"generatePlanets",value:function(){for(var j=[],k=10;0<k;k--)c.spawnPlanet(j);for(var k=j.length-1;0<=k;k--)10>j[k].size&&j.splice(k,1);return j}},{key:"spawnPlanet",value:function(j){var q,k=50,n=rand(rand(50,75),100),s=!1,u=0;do{for(var z in 10<u&&(u=0,n/=2),q=new vec2(rand(n+k,600-n-k),rand(50+n+k,600-n-k)),s=!1,j)q.distance(j[z].pos)<=n+j[z].size+k&&(s=!0);u++}while(s);j.push(new c(q,n))}}]),c}();function drawPlanets(c,g){c.forEach(function(j){j.draw(g)})}var _createClass=function(){function c(g,j){for(var n,k=0;k<j.length;k++)n=j[k],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(g,n.key,n)}return function(g,j,k){return j&&c(g.prototype,j),k&&c(g,k),g}}();function _possibleConstructorReturn(c,g){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&("object"===("undefined"==typeof g?"undefined":_typeof(g))||"function"==typeof g)?g:c}function _inherits(c,g){if("function"!=typeof g&&null!==g)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof g?"undefined":_typeof(g)));c.prototype=Object.create(g&&g.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(c,g):c.__proto__=g)}function _classCallCheck(c,g){if(!(c instanceof g))throw new TypeError("Cannot call a class as a function")}var effect=function(){function c(g){_classCallCheck(this,c),this.pos=g,this.size=25,this.grow=2,this.color=[250,240,0],this.life=10}return _createClass(c,[{key:"add",value:function(){effects.push(this)}},{key:"remove",value:function(){effects.splice(effects.indexOf(this),1)}},{key:"draw",value:function(j){this.size+=this.grow;var k=10,n=1;this.life<k&&(n=this.life/k),j.fillStyle="rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+","+n+")",j.beginPath(),j.arc(this.pos.x,this.pos.y,this.size,0,2*Math.PI),j.fill(),this.life-=1,0>=this.life&&this.remove()}}]),c}();function drawEffects(c){for(var g=effects.length-1;0<=g;g--)effects[g].draw(c)}var tracer=function(){function c(){_classCallCheck(this,c),this.points=[],this.color=[200,250,200],this.life=300,this.closed=!1}return _createClass(c,[{key:"trace",value:function(j){var k={pos:j,life:this.life};this.points.push(k)}},{key:"close",value:function(){this.closed=!0}},{key:"add",value:function(){tracers.push(this)}},{key:"remove",value:function(){tracers.includes(this)&&tracers.splice(tracers.indexOf(this),1)}},{key:"update",value:function(){this.closed&&0>=this.points.length&&this.remove();for(var j=this.points.length-1;0<=j;j--)this.points[j].life-=1,0>=this.points[j].life&&this.points.splice(j,1)}},{key:"draw",value:function(j){if(!(0>=this.points.length)){var k=1;this.points[0].life<this.life/5&&(k=this.points[0].life/(this.life/5)),j.fillStyle="rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+","+k+")",j.beginPath(),j.arc(this.points[0].pos.x,this.points[0].pos.y,4,0,2*Math.PI),j.fill();for(var n=1;n<this.points.length;n++){var o=n-1,k=1;this.points[o].life<this.life/5&&(k=this.points[o].life/(this.life/5)),j.strokeStyle="rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+","+k+")",j.lineWidth=2*k,j.beginPath(),j.moveTo(this.points[o].pos.x,this.points[o].pos.y),j.lineTo(this.points[n].pos.x,this.points[n].pos.y),j.stroke()}this.closed&&(j.fillStyle="rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+","+k+")",j.beginPath(),j.arc(this.points[this.points.length-1].pos.x,this.points[this.points.length-1].pos.y,3,0,2*Math.PI),j.fill())}}}]),c}(),flashText=function(c){function g(j,k){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,g);var o=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return o.color=[50,200,40],o.fcolor=n,o.pos=j,o.pos.y+=10,o.life=45,o.txt=k,o}return _inherits(g,c),_createClass(g,[{key:"draw",value:function(k){this.pos.y-=0.5;var n=this.color;this.fcolor&&(n=100<=timeElapsed%200?this.color:this.fcolor);var o=30,q=1;this.life<o&&(q=this.life/o),k.fillStyle="rgba("+n[0]+","+n[1]+","+n[2]+","+q+")",k.font="bold 16px sans-serif",k.textAlign="center",k.fillText(this.txt,this.pos.x,this.pos.y),this.life-=1,0>=this.life&&this.remove()}}]),g}(effect);function updateTracers(){for(var c=tracers.length-1;0<=c;c--)tracers[c].update()}function drawTracers(c){tracers.forEach(function(g){g.draw(c)})}var spawnDelay=500,maxEnemies=3,tilspawn=spawnDelay,ammoitems=0;function initSpawnVars(){spawnDelay=600,maxEnemies=3,tilspawn=spawnDelay}function handleSpawns(){enemies.length<maxEnemies&&(tilspawn-=1,0>=tilspawn&&(spawnEnemy(),recalculateSpawnVars())),0>=ammoitems&&spawnAmmoItem()}function recalculateSpawnVars(){var c=elapsedGameTime();spawnDelay=470/Math.max(c/6e4,1)+30,maxEnemies=2+c/1e4}function spawnAmmoItem(){var c=new item_ammo;c.pos=planets[Math.floor(rand(0,planets.length))].pos,c.pos=c.pos.plus(vec2.fromAng(rand(0,2*Math.PI))),c.add(),c.update(),c.flash()}function spawnEnemy(){tilspawn=spawnDelay*enemies.length;var c=getSpawnEnemyList(),g=Math.floor(rand(0,c.length)),j=c[g];j.add();var k=1-(g+1)/c.length;tilspawn-=rand(k*spawnDelay)}function getSpawnEnemyList(){var c=elapsedGameTime(),g=[];return g.push(new en_crawler),3e4<c&&g.push(new en_mover),6e4<c&&(g.push(new en_shooter),g.push(new en_orbiter)),9e4<c&&g.push(new en_mover),1.2e5<c&&g.push(new en_shooter),2.4e5<c&&g.push(new en_shooter),g}function updateTilSpawn(){recalculateSpawnVars(),Math.min(tilspawn,spawnDelay*enemies.length)}</script>
</head>
<body style=" text-align:center; background-color:black; margin:0px;">
	<canvas id="canvas" width="600px" height="600px"></canvas>
	<script type="application/javascript">"use strict";var canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),timeElapsed=0,gameStart=0,dt=0,odt=0,mode=0,saveKey="technostalgic_LD38_highschore",score=0,hiscore=0,planets=[],enemies=[],projectiles=[],items=[],gibs=[],effects=[],tracers=[],player1,controls=[37,39,38,40,88,67,32],controlState={moveLeft:!1,moveRight:!1,increasePow:!1,decreasePow:!1,jump:!1,fire:!1,menu:!1},musicOn=!0,sfx={};function clearScreen(a){a.fillStyle="#fff",a.fillRect(0,0,canvas.width,canvas.height)}function hook_controls(){document.addEventListener("keydown",handleControlsDown),document.addEventListener("keyup",handleControlsUp)}function handleControlsDown(a){switch(console.log(a.key+":"+a.keyCode),77==a.keyCode&&toggleMusic(),a.keyCode){case controls[0]:controlState.moveLeft=!0;break;case controls[1]:controlState.moveRight=!0;break;case controls[2]:controlState.increasePow=!0;break;case controls[3]:controlState.decreasePow=!0;break;case controls[4]:controlState.jump=!0;break;case controls[5]:controlState.fire=!0;break;case controls[6]:controlState.menu=!0;}}function handleControlsUp(a){switch(a.keyCode){case controls[0]:controlState.moveLeft=!1;break;case controls[1]:controlState.moveRight=!1;break;case controls[2]:controlState.increasePow=!1;break;case controls[3]:controlState.decreasePow=!1;break;case controls[4]:controlState.jump=!1;break;case controls[5]:controlState.fire=!1;break;case controls[6]:controlState.menu=!1;}}window.addEventListener("keydown",function(a){-1<[32,37,38,39,40].indexOf(a.keyCode)&&a.preventDefault()},!1);function elapsedGameTime(){return timeElapsed-gameStart}function init(){loadSound(),loadHighScore(),mode=0,hook_controls(),requestAnimationFrame(step)}function step(){for(odt+=dt;16.66667<=odt;)update(),odt-=16.66667;draw(context),requestAnimationFrame(step),dt=Math.max(0,performance.now()-timeElapsed),timeElapsed=performance.now()}function update(){return 1==mode?void(updateGame(),handleSpawns()):void menuUpdate()}function draw(a){return clearScreen(a),1==mode?void(drawGame(a),drawHUD(a)):void(2==mode?drawEndScreen(a):drawStartScreen(a))}function loadSound(){sfx={music:new Audio("sfx/music.wav"),startGame:new Audio("sfx/startGame.wav"),shoot:new Audio("sfx/shoot.wav"),empty:new Audio("sfx/empty.wav"),jump:new Audio("sfx/jump.wav"),land:new Audio("sfx/land.wav"),pickup:new Audio("sfx/pickup.wav"),explosion:new Audio("sfx/explosion.wav"),explosionSmall:new Audio("sfx/explosionSmall.wav"),death:new Audio("sfx/death.wav"),enemySpawn:new Audio("sfx/enemy_spawn.wav"),enemyDeath:new Audio("sfx/enemy_death.wav"),shooterDeath:new Audio("sfx/shooter_death.wav"),shooterShoot:new Audio("sfx/shooter_shoot.wav")}}function updateGame(){updateCharacters(enemies),player1.update(),player1.control(controlState),updateCharacters(projectiles),updateCharacters(items),updateCharacters(gibs),updateTracers()}function drawGame(a){drawTracers(a),drawPlanets(planets,a),drawCharacters(enemies,a),drawCharacters(projectiles,a),drawCharacters(items,a),drawCharacters(gibs,a),player1.draw(a),drawEffects(a)}function drawHUD(a){a.fillStyle="rgba(100,100,0,0.1)",a.fillRect(0,0,600,50),a.lineWidth=3,a.fillStyle="#ded",a.strokeStyle="#070",a.textAlign="left",a.font="bold 36px sans-serif",a.strokeText(score.toString(),2,42),a.fillText(score.toString(),2,42),a.font="bold 12px sans-serif",a.strokeText("SCORE  |  HIGH : "+hiscore.toString()+" ",0,10),a.fillText("SCORE  |  HIGH : "+hiscore.toString()+" ",0,10),a.fillStyle="#ffa",controlState.fire&&0>=player1.ammo&&(a.fillStyle=100<timeElapsed%200?"#f66":"#ffa"),a.strokeStyle="#a90",a.textAlign="center",a.font="bold 12px sans-serif",a.strokeText("AMMO",300,10),a.fillText("AMMO",300,10),a.font="bold 36px sans-serif",a.strokeText(player1.ammo.toString(),300,42),a.fillText(player1.ammo.toString(),300,42)}function menuUpdate(){controlState.menu&&startGame()}function drawStartScreen(a){startscreen_drawTitle(a),startscreen_drawStartPrompt(a)}function drawEndScreen(a){updateGame(),drawGame(a),a.fillStyle="rgba(0, 0, 0, 0.4)",a.fillRect(0,0,600,600),console.log(mode),endscreen_drawGameover(a),endscreen_drawScore(a),endscreen_drawStartPrompt(a)}function startscreen_drawStartPrompt(a){var b="#ddd";250<=timeElapsed%500&&(b="#777"),a.fillStyle=b,a.textAlign="center",a.font="bold 28px sans-serif",a.fillText("PRESS SPACE TO START",300,500)}function startscreen_drawTitle(a){a.fillStyle="#bfb",a.strokeStyle="#5c5",a.lineWidth=1,a.textAlign="center",a.font="bold 86px sans-serif",a.fillText("Hopper.",300,100),a.strokeText("Hopper.",300,100)}function endscreen_drawGameover(a){a.fillStyle="#faa",a.strokeStyle="#a11",a.lineWidth=1,a.textAlign="center",a.font="bold 86px sans-serif",a.fillText("GAME OVER",300,100),a.strokeText("GAME OVER",300,100)}function endscreen_drawScore(a){a.fillStyle="#fff",a.textAlign="center",a.font="bold 24px sans-serif",a.fillText("YOUR SCORE",300,150),a.fillText("HIGH SCORE",300,300),a.fillStyle="#dfd",a.lineWidth=1,a.font="bold 62px sans-serif",a.fillText(score.toString(),300,205),a.font="bold 42px sans-serif",a.fillText(hiscore.toString(),300,340)}function endscreen_drawStartPrompt(a){var b="#ddd";250<=timeElapsed%500&&(b="#777"),a.fillStyle=b,a.textAlign="center",a.font="bold 28px sans-serif",a.fillText("PRESS SPACE TO RESTART",300,500)}function startGame(){mode=1,enemies=[],projectiles=[],effects=[],tracers=[],items=[],gibs=[],planets=planet.generatePlanets(),gameStart=timeElapsed,score=0,ammoitems=0,playSound(sfx.startGame),loopMusic(),player1=new player,player1.chooseRandPos()}function endGame(){mode=2,saveHighScore()}function addScore(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:null;if(!player1.isDead){if(b){var c=new flashText(b.clone(),a.toString());200<=a&&(c.fcolor=[60,255,160]),c.add()}score+=a}}function loadHighScore(){try{var a=localStorage.getItem(saveKey);if(null==a)return void(hiscore=0);hiscore=Number.parseInt(a)}catch(b){return alert("Warning: You have site storage disabled!\nYou can still play the game, but your high scores will not be saved."),void(hiscore=0)}}function saveHighScore(){hiscore=Math.max(score,hiscore);try{localStorage.setItem(saveKey,hiscore)}catch(a){}}function playSound(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;b&&(a.currentTime=0),a.play()}function loopMusic(){musicOn&&(sfx.music.addEventListener("ended",startMusicLoop),sfx.music.play())}function startMusicLoop(){musicOn&&(sfx.music.currentTime=0,sfx.music.play())}function toggleMusic(){musicOn=!musicOn,musicOn?loopMusic():!sfx.music.paused&&sfx.music.pause()}function DEBUGSTART(){var a=new en_shooter;a.add()}function rand(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1;return Math.random()*(b-a)+a}function mod(a,b){return 0<a?a%b:a%b+b}function angDist(a,b){var c=b-a;return c=mod(c+Math.PI,2*Math.PI)-Math.PI,c}init();</script>
</body>